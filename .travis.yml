dist: xenial
language: cpp
os:
  - linux
  # - windows
  # - osx
compiler: 
  - gcc
  - clang
env: 
  - JOB_DEF='-DCMAKE_CXX_FLAGS="-fsanitize=thread -g -O1"'
  - JOB_DEF='-DCMAKE_CXX_FLAGS="-fsanitize=address -fno-optimize-sibling-calls -fsanitize-address-use-after-scope -fno-omit-frame-pointer -g -O1"'
  - JOB_DEF='-DCMAKE_CXX_FLAGS="-fsanitize=memory -fno-optimize-sibling-calls -fsanitize-memory-track-origins=2 -fno-omit-frame-pointer -g -O2"'
  - JOB_DEF='-DCMAKE_CXX_FLAGS="-fsanitize=leak -fno-omit-frame-pointer -g -O1"'
  - JOB_DEF='-DCMAKE_CXX_FLAGS="-fsanitize=undefined"'
before_install: 
  -
   if [ "$TRAVIS_OS_NAME" = "linux" ] ; then 
     if [ "$TRAVIS_COMPILER" = "gcc" ] ; then
       sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y `# for g++-8` ;
     fi &&
     sudo add-apt-repository ppa:beineri/opt-qt-5.11.1-xenial -y `# for Qt 5.11` &&
     sudo apt-get update ;
   fi

install:
  -
   if [ "$TRAVIS_OS_NAME" = "linux" ] ; then 
     if [ "$TRAVIS_COMPILER" = "gcc" ] ; then
       sudo apt-get install -y g++-8 &&
       sudo ln -s /usr/bin/g++-8 /usr/local/bin/g++ ;
     fi &&
     sudo apt-get install -y 
       libasound2-dev 
       qt511-meta-minimal 
       libgl1-mesa-dev 
       libglu1-mesa-dev &&
     (cd /tmp && 
       wget https://github.com/google/googletest/archive/release-1.8.1.tar.gz ; 
       tar xf release-1.8.1.tar.gz && 
       mkdir googletest-release-1.8.1/build && 
       cd googletest-release-1.8.1/build && 
       cmake -DBUILD_SHARED_LIBS=ON .. && 
       sudo make install) ;
     fi 

before_script: mkdir build
script: 
  - (cd build && cmake '$JOB_DEF' .. && make)
  - (cd build && ctest)
jobs:
  include:
    - stage: checks
      name: cpplint
      install: sudo pip install cpplint
      env: 
      compiler: 
      script: cpplint --recursive .